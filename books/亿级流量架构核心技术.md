## 目录

## 交易型系统的一些设计原则

###   高并发原则
*  无状态
*  拆分
*  服务化
*  消息队列
*  数据异构
*  缓存银弹
*  并发化

### 高可用原则
* 降级
* 限流
* 切流量
* 可回滚

### 业务设计原则
* 防重设计
* 幂等设计
* 流程可定义
* 状态和状态机
* 后台系统操作可反馈
* 后台系统审批化
* 文档和注释
* 备份

# 高可用

### 负载均衡和反向代理
 * upstream 配置
 * 负载均衡算法
 * 失败重试
 * 健康检查  
    心跳： tcp、http
 * 其他配置
    域名上游服务器、备份上游服务器、不可用上游服务器
 * 长链接
 * http反向代理
 * http 动态负载均衡
   consul+consul+template 、consul+openresty
 * nginx 四层负载均衡
    静态负载均衡、动态负载均衡
### 隔离术
* 线程隔离
* 进程隔离
* 集群隔离
* 机房隔离
* 读写隔离
* 动静隔离
* 爬虫隔离
* 热点隔离
* 资源隔离
* 使用hystrix隔离 
   hystrix简介、隔离事例
* 基于servlet3实现请求隔离
 1 请求解析和业务处理线程池分离
 2 业务线程池隔离
 3 业务线程池监控/运维/降级
 4 如何使用servlet3异步化 
 5 一些servlet3 异步化压测数据
 
## 限流详解
 
### 限流算法 
  * 令牌桶算法
  * 漏桶算法
### 应用级限流
  * 限流总并发、链接、请求数 
  * 限流总资源数
  * 限流某个接口的总并发、请求数
  * 限流某个接口的时间窗口请求数
  * 平滑限流某个接口的请求数
  
### 分布式限流
  * redis+lua
  * nginx+lua
### 接入层限流
  * ngx_http_limit_conn_module
  * ngx_http_limit_req_module
  * lua_resty-limit-traffic
  
### 节流
   * throttleFirst/throttleLast
   * throttleWithTimeout

## 降级特技
  * 降级预案
  * 自动开关降级
1.  超时降级
2.  统计失败次数降级
3.  故障降级
4.  限流降级
  * 人工开关降级
  * 读服务降级
  * 写服务降级
  * 多级降级
  * 配置中心
1.  应用层api封装
2.  使用配置文件实现开关配置
3.  使用配置中心实现开关配置
  * 使用hystrix 实现降级
  * 使用hystrix 实现熔断
1.  熔断机制实现
2.  配置示例
3.  采样统计
 ## 超时与重试机制
 
   * 简介
   * 代理层超时与重试
 1. nginx
 2. twemproxy
   * web容器超时与重试 
   * 数据库客户端超时
   * nosql 客户端超时
   * 业务超时
   * 前端ajax超时
   * 总结&参考资料
   
## 回滚机制
   * 事务回滚
   * 代码库回滚
   * 部署版本回滚
   * 数据版本回滚
   * 静态资源版本回滚
   
## 压测与预案
   * 系统压测
     online/offline
   * 系统优化与容灾
   * 应急预案
   
# 高并发

## 应用级缓存
* 缓存简介
* 缓存命中率
* 缓存回收策略
* java 缓存类型
1. 堆缓存
2. 堆外缓存
3. 磁盘缓存
4. 分布式缓存
5. 多级缓存
*  应用级缓存示例
1. 多级缓存api封装
2. null cache
3. 强制获取最新数据
4. 失败统计
5. 延迟报警
 * 缓存使用模式实践
1. cache-aside
2. cache-as-sor
3. read-through
4. write-through
5. write-behind
6. copy-pattern
 * 性能测试
    

## http缓存
* http缓存 
      last-modified   
      etag  
* httpclient客户端缓存
1. 主流程
2. 清除无效缓存
3. 查找缓存
4. 缓存未命中
5. 缓存命中
6. 缓存内容陈旧需要验证
7. 缓存内容无效需重新执行请求
8. 缓存相应
9. 缓存头总结
* nginx http 缓存设置
1. expires
2. is-modified-since
3. nginx proxy_pass
* nginx代理层缓存
1. nginx代理层缓存配置
2. 清理缓存
## 多级缓存 
 * 如何缓存数据
1. 过期与不过期
2. 维度化缓存与增量缓存
3. 大value缓存
4. 热点缓存
 * 分布式缓存与应用负载均衡
1. 缓存分布式
2. 应用负载均衡
 * 热点数据与更新缓存
1. 单机全量缓存+主从
2. 分布式缓存和应用本地热点
 * 更新缓存与原子性
 * 缓存崩溃与快速修复
1. 取模
2.  一致性哈希
3. 快速恢复

## 链接池线程池详解
 * 数据库连接池
 1. dbcp
 2. dpcp配置建议
 3. 数据库驱动超时实现
 4. 连接池使用的一些建议
     
 * httpclient连接池
 1. httpclient 4.5.4配置
 2. httpclient 连接池源码分析
 3. httpclient 4.2.3
 4. 问题示例
     
 * 线程池
 1. java 
 2. tomcat
       
## 异步并发实战
   * 同步阻塞调用
   * 异步future 
   * 异步callback
   * 异步编排completablefuture
   * 异步web服务实现
   * 请求缓存
   * 请求合并

## 如何扩容
 * 单体应用垂直扩容
 * 单体应用水平扩容
 * 应用拆分
 * 数据库拆分
 * 数据库分表分裤示例
1. 应用层还是中间层
2. 分库分表策略
3. 使用 sharding-jdbc 分库分表
4. sharding-jdbc 分库分表配置
5. 使用sharding-jdbc 读写分离
 * 数据异构
1. 查询维度异构
2. 聚合数据异构
 * 任务系统扩容
1. 简单任务
2. 分布式任务
3. elastic-job-lite
        
## 队列
 * 应用场景
 * 缓冲队列
 * 任务队列
 * 消息队列
 * 请求队列
 * 数据总线队列
 * 混合队列
 * 其他队列
 * disruptor_redis 队列
 * 下单系统水平可扩展架构
 * 基于 canal实现数据异构
 
